---
- name: Exécuter un scan de vulnérabilités avec OpenSCAP
  command: oscap xccdf eval --profile stig /usr/share/xml/scap/ssg/content/ssg-ubuntu1804-ds.xml --results /tmp/scan_results.xml --report /tmp/scan_report.html
  register: scan_result
  ignore_errors: yes
https://github.com/AhmedSouai/projet_perso/tree/main/ansible-infrastructure-automation
- name: Lire le fichier de résultats du scan
  command: xmllint --xpath "string(//xccdf:EvaluationResult//xccdf:Value[@id='total'])" /tmp/scan_results.xml
  register: vulnerability_count
  failed_when: false

- name: Afficher le nombre de vulnérabilités détectées
  debug:
    msg: "Le serveur {{ inventory_hostname }} a détecté {{ vulnerability_count.stdout }} vulnérabilités."
  when: vulnerability_count.stdout is defined
